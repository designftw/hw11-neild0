<!DOCTYPE html>
<html>
<head>
    <link href="styles.css" rel="stylesheet"/>
    <script src="./chat.js" type="module"></script>
    <meta charset="UTF-8">
</head>
<body>
<div class="container" id="app">
    <h1 class="title">
        Group Chat App
    </h1>

    <p>
        <button @click="$gf.toggleLogIn" class="login-btn">
            {{ $gf.me? 'Log Out' : 'Log In' }}
        </button>
    </p>



    <!-- If we're not logged in, hide everything except the login button -->
    <template v-if="$gf.me">

        <p>
            <!-- We display names in multiple places, so we made a -->
            <!-- reusable <name></name> component. -->
            <!-- See below for the template. -->
            My Name Is:
            <name :actor="$gf.me" :editable="true"></name>
        </p>

        <!--      <p>-->
        <!--        Change chat format:-->
        <!--        <input type="radio" id="channel" :value="false" v-model="privateMessaging" />-->
        <!--        <label for="channel">Channel-based public chat</label>-->

        <!--        <input type="radio" id="pm" :value="true" v-model="privateMessaging" />-->
        <!--        <label for="pm">Private Messaging</label>-->
        <!--      </p>-->
        <!--      <p v-else>-->
        <!--        <label for="recipient">-->
        <!--          Paste the Actor ID of who you'd like to chat with:-->
        <!--        </label>-->
        <!--        <input id="recipient" v-model="recipient"/>-->
        <!--      </p>-->

        <input id="channel" v-model="channel"/>

        <div class="messages-container">

            <ul>
                <!-- List all the messages -->
                <li :key="message.id" v-for="message of messages.slice().reverse()">

                    <div class="message-line">

                        <div class="message-controls" v-if="message.actor==$gf.me">
                            <button @click="startEditMessage(message)" class="message-control">‚úèÔ∏è</button>
                            <button @click="removeMessage(message)" class="message-control">üóëÔ∏è</button>
                        </div>

                        <div class="message-wrapper">
                            <div :class="{'sender-me': message.actor==$gf.me, 'sender-other': message.actor!=$gf.me}"
                                 class="message-sender">
                                <name :actor="message.actor"></name>
                                <like :messageid="message.id"></like>
                            </div>
                            <div class="attachment-message-wrapper">
                                <div :class="{'message-me': message.actor==$gf.me, 'message-other': message.actor!=$gf.me}"
                                     class="message-bubble">
                                    <!-- Display and edit form if we're editing a message -->
                                    <form @submit.prevent="saveEditMessage(message)" v-if="editID==message.id">
                                        <input v-model="editText">
                                        <input type="submit" value="Save"/>
                                    </form>


                                    <!-- Otherwise, display a bunch of properties from the message -->
                                    <ul v-else>
                                        <li>
                                            {{ message.content }}
                                        </li>
                                        <!--            <li>-->
                                        <!--              From Actor ID: {{ message.actor }}-->
                                        <!--            </li>-->
                                        <!--            <template v-if="privateMessaging">-->
                                        <!--              <li>-->
                                        <!--                To Name: <name :actor="message.bto[0]"></name>-->
                                        <!--              </li>-->
                                        <!--              <li>-->
                                        <!--                To Actor ID: {{ message.bto[0] }}-->
                                        <!--              </li>-->
                                        <!--            </template>-->
                                        <!--            <li>-->
                                        <!--              Published at Time: {{ message.published }}-->
                                        <!--            </li>-->
                                        <!--            <li>-->
                                        <!--              Last Edited at Time: {{ message.updated }}-->
                                        <!--            </li>-->
                                        <!--            <li>-->
                                        <!--              &lt;!&ndash; This is a unique identifier that can be used to "link" to messages &ndash;&gt;-->
                                        <!--              ID: {{ message.id }}-->
                                        <!--            </li>-->

                                        <!-- Only add these controls if the message is ours -->
                                        <!-- You can't edit or delete other people's messages -->

                                    </ul>
                                </div>
                                <div v-if="message.attachment" :class="{'message-me': message.actor==$gf.me, 'message-other': message.actor!=$gf.me}"
                                     class="message-bubble">
                                    <div class="attachment-div">
                                        <div v-if="downloadedImages[message.attachment.magnet]">
                                            <a :href="downloadedImages[message.attachment.magnet]" download>
                                                <img :src="downloadedImages[message.attachment.magnet]"/>
                                            </a>
                                        </div>
                                        <div v-else>
<!--                                            loading circle -->
                                            <div class="loader"></div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>

        </div>
        <form @submit.prevent="sendMessage">
            <input placeholder="Type a message..." type="text" v-model="messageText"/>
            <input @change="handleFileUpload" ref="fileInput" type="file"/>
            <input type="submit" value="Send"/>
        </form>

    </template>
    <!-- A form for sending messages -->

</div>


<template id="name">
    <span v-if="!editing">

      <!-- If we're not editing the name-->
        <!-- Display the profile's name, if it exists -->
        <!-- or anonymous if it doesn't -->
      {{ profile? profile.name : 'Anonymous' }}

        <!-- Also if the name is "editable" add an edit button -->
      <button @click="editName" v-if="editable">
        Edit Name
      </button>
    </span>

    <!-- If we're in the editing state, create something to edit the name-->
    <form @submit.prevent="saveName" v-else>
        <input v-model="editText"/>
        <input type="submit" value="Save Name"/>
    </form>
</template>

<template id="like">

    <div class="likes-count" v-if="likes.length!==0">
        {{ likes.length }} Like<span v-if="likes.length>1">s</span>
    </div>
    <div>
        <button @click="sendLike" v-if="!liked">Like</button>
        <button @click="removeLike" v-if="liked">Unlike</button>
    </div>
</template>

</body>
</html>
